# 三分钟看明白WAF {#concept_lpz_q5l_l2b .concept}

WAF是阿里云云盾提供的Web应用防火墙，帮助您监控网站上的HTTP/HTTPS访问请求，并通过自定义过滤规则和启用Web攻击防护、安全合规等功能，帮助您部署网站访问控制。

在使用WAF时，

-   您需要开通WAF并将网站接入WAF，使网站的访问流量全部流转到WAF。下图显示了开通和接入WAF的简要流程，具体操作参见下文说明。
-   WAF将按照您配置的过滤规则和启用的Web防护功能，检测并过滤收到的访问请求，只有满足规则条件的合法请求才会经WAF返回到您的服务器（回源）。具体内容参见下文[如何选用WAF防护功能](#section_f5b_s5l_l2b)和[如何用好WAF](#section_o5b_s5l_l2b)。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15550/15371768807111_zh-CN.png)

## 如何开通WAF {#section_xtb_s5l_l2b .section}

您可以使用按量付费或包年包月的计费方式来开通WAF。

-   按量付费按当日被防护网站的访问QPS峰值和当日选用的WAF防护功能，生成后付费账单；每日结算前一日费用。
-   包年包月按月/年计费，由您选购适用的WAF套餐，生成账单后直接付费；您可在选购的时长内享用套餐内的防护服务。

    **说明：** 使用包年包月方式选购WAF套餐时，我们需要了解您的正常业务流量，以便区分DoS攻击等异常流量。每种WAF套餐支持不同的业务带宽，如果您的实际业务正常流量大于套餐内的带宽限制，您需要[购买额外带宽](../../../../cn.zh-CN/产品定价/开通 WAF/额外带宽扩展说明.md#)。


![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15550/15371768817112_zh-CN.png) 关于WAF计费方式的详细描述，请参考[计费方式](../../../../cn.zh-CN/产品定价/计费方式.md#)。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15550/15371768817113_zh-CN.png) 关于开通WAF的具体操作，请参考[购买Web应用防火墙](../../../../cn.zh-CN/产品定价/开通 WAF/购买Web应用防火墙.md#)。

开通WAF后，您将获得一个WAF实例（对应一个实例IP）；您可以使用这个WAF实例接入最多10个网站，为其开启防护，这10个网站只能使用1个一级域名。

-   如果您希望防护具有不同一级域名的网站，您需要[购买域名扩展包](../../../../cn.zh-CN/产品定价/开通 WAF/扩展域名包说明.md#)。
-   如果您有很重要的域名需要单独防护，而非使用同一个WAF IP防护所有域名，您可以[购买独享IP包](../../../../cn.zh-CN/产品定价/开通 WAF/独享IP包说明.md#)。

## 如何接入WAF {#section_c5b_s5l_l2b .section}

开通WAF后，您需要通过[域名解析（DNS）](https://en.wikipedia.org/wiki/Domain_Name_System)，将访问您网站的流量流转到已开通的WAF实例（IP）上，并设置由WAF实例在过滤掉恶意请求后，将合法的访问流量再返回到您的源站服务器。

以上操作就是接入WAF，它分为两个环节：

-   所有访问流量由客户端到WAF

    您将要防护的网站（域名）添加到WAF，WAF分配给这个域名一个[CNAME地址](https://en.wikipedia.org/wiki/CNAME_record)。您只要在对应域名的解析记录中添加并应用这条CNAME记录，就可以将通过域名访问您网站的流量导向WAF实例。

    **说明：** 我们并没有在控制台上体现您的WAF实例IP，如果您想知道该IP，您可以使用`ping`命令，ping分配给您域名的CNAME地址。

-   过滤后的访问流量由WAF到源站服务器

    您只需要告诉我们您的源站服务器地址，它可以是IP或其他地址（如对象存储OSS的CNAME等），WAF就会将过滤后的访问流量返还到您指定的源站地址。


如果您的域名使用[阿里云云解析DNS](https://wanwang.aliyun.com/domain/dns/) 进行域名解析，我们支持一键式接入WAF；否则，您需要手动接入。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15550/15371768817113_zh-CN.png) 关于接入WAF的具体操作，请参考[添加网站配置](../../../../cn.zh-CN/快速入门/步骤1：添加网站配置.md#)。

## 如何选用WAF防护功能 {#section_f5b_s5l_l2b .section}

WAF分析客户端使用HTTP/HTTPS协议发送的GET/POST请求，并应用访问规则过滤恶意访问流量。

**说明：** 下述功能项对应不同的（按量付费）收费标准，或（包年包月）套餐，您可以在[Web应用防火墙价格页](https://www.aliyun.com/price/product?#/waf/detail)了解具体的计费信息。

-   您可以使用**精准访问控制**，自定义访问规则，过滤客户端IP、请求URL、以及常见的请求头字段。有关操作请参考[黑白名单配置](cn.zh-CN/用户指南/防护配置/IP黑白名单配置.md#)、[精准访问控制](cn.zh-CN/用户指南/防护配置/精准访问控制.md#)。
-   您也可以直接使用Web防护功能，抵御常见的Web攻击。我们结和Web攻击特征，分析请求头和请求主体，编写了精准的过滤算法，并将这些复杂的过滤算法封装各类防护功能，方便您直接使用。WAF提供的防护功能包括：

    **说明：** WAF使用多层过滤的机制，即您在启用WAF并配置防护功能后，一个客户端请求在经过WAF时，实际上按顺序经过了多层过滤。默认的防护检测顺序为：**精准访问控制** \> **CC防护** \> **Web应用攻击防护**。

    -   **Web攻击防护**：帮助您防护SQL注入、XSS跨站攻击等常见的Web攻击。有关操作请参考[Web应用攻击防护规则策略](cn.zh-CN/用户指南/防护配置/Web应用攻击防护.md#)。
    -   **CC攻击防护**：帮助您防护针对页面请求的CC攻击。有关操作请参考[选择CC防护模式](cn.zh-CN/用户指南/防护配置/CC安全防护.md#)、[自定义CC防护](cn.zh-CN/用户指南/防护配置/自定义CC防护.md#)。
    -   **智能防护引擎**：对请求做语义分析，检测经伪装或隐藏的恶意请求，帮助您防护通过攻击混淆、变种等方式发起的恶意攻击。有关操作请参考[新智能防护引擎](cn.zh-CN/用户指南/防护配置/新智能防护引擎.md#)。
    -   **恶意IP惩罚**：帮助您自动封禁在短时间内进行多次Web攻击的客户端IP。有关操作请参考[恶意IP封禁](cn.zh-CN/用户指南/防护配置/恶意IP惩罚.md#)。
    -   **地理IP封禁**：帮助您一键封禁来自指定国内省份或海外地区的IP的访问请求。有关操作请参考[封禁地区](cn.zh-CN/用户指南/防护配置/封禁地区.md#)。
    -   **数据风控**：帮助您对抗机器威胁，如垃圾注册、账号被盗、活动作弊、垃圾消息等欺诈行为。有关操作请参考[数据风控](cn.zh-CN/用户指南/防护配置/数据风控.md#)。
-   WAF也可以满足您的部分安全合规需求。WAF提供的安全合规功能包括：

    -   **网页防篡改**：帮助您锁定需要保护的网站页面，被锁定的页面在收到请求时，返回您为其设置的缓存内容。有关操作请参考[网页防篡改](cn.zh-CN/用户指南/防护配置/网站防篡改.md#)。
    -   **敏感信息防泄漏**：帮助您过滤服务器返回内容（异常页面或关键字）中的敏感信息，如身份证号、银行卡号、电话号码、和敏感词汇等。有关操作请参考[防敏感信息泄露](cn.zh-CN/用户指南/防护配置/防敏感信息泄露.md#)。

此外，WAF还提供了方便的监控管理功能：

-   **安全监控**：您可以在[WAF控制台总览页面](cn.zh-CN/用户指南/防护统计/总览.md#)查看图表化的业务访问数据以及安全防护统计信息。
-   **安全报表**：您可以在这里查询您的域名在30天内受到的攻击详情和风险预警信息。有关操作请参考[攻击防护报表](cn.zh-CN/用户指南/防护统计/攻击防护报表.md#)和[风险预警报表](cn.zh-CN/用户指南/防护统计/风险预警报表.md#)。
-   **全量日志**：您可以在这里搜索您的网站日志，并使用在线分析快速定位请求。有关操作请参考[全量日志查询](cn.zh-CN/用户指南/防护统计/全量日志查询.md#)。
-   **数据大屏**：您可以在这里查看WAF的实时攻防态势监控和告警。有关操作请参考[可视化大屏](cn.zh-CN/用户指南/防护统计/数据大屏.md#)。

## 如何用好WAF {#section_o5b_s5l_l2b .section}

启用WAF后，您的源站服务器收到的所有请求都来自WAF实例，服务器IP对客户端来说是隐藏的。

-   如果您希望获取一个访问请求的真实客户端IP，请参考[获取访问者真实IP](../../../../cn.zh-CN/最佳实践/获取访问者真实IP.md#)。
-   如果您的源站服务器IP已公开或不慎泄露，这样的话，攻击者可能越过域名解析，也即越过WAF，直接对您的源站发动攻击。要想有效防护这种情形，您需要[配置源站保护](../../../../cn.zh-CN/最佳实践/源站保护.md#)。
-   如果您同时使用了阿里云[DDoS高防IP服务](https://www.aliyun.com/product/ddos)或者[CDN服务](https://www.aliyun.com/product/cdn)，您可能需要以下帮助：

    **说明：** 这种情况下，您在接入WAF时，应当勾选**WAF前是否有七层代理**下的**是**。

    -   [高防IP结合WAF](cn.zh-CN/用户指南/接入WAF/高防IP结合WAF.md#)
    -   [CDN结合WAF](cn.zh-CN/用户指南/接入WAF/CDN结合WAF.md#)
-   如果您希望对您的原生App进行安全防护，解决CC攻击、机器滥刷等问题，您可以参考WAF的[SDK方案](cn.zh-CN/用户指南/SDK方案/SDK方案简介.md#)。

